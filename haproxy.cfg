global
    maxconn 1000
    log stdout format raw local0

defaults
    mode tcp
    log global
    option tcplog
    option dontlognull
    timeout connect 5s
    timeout client 30s
    timeout server 30s
    retries 3

# Stats page
listen stats
    bind *:8404
    mode http
    stats enable
    stats uri /
    stats refresh 10s
    stats admin if LOCALHOST

# PostgreSQL Write (Primary only)
listen postgres-write
    bind *:5432
    option pgsql-check user shahin_admin
    default-server inter 3s fall 3 rise 2
    server pg-primary pg-primary:5432 check
    server pg-replica pg-replica:5432 check backup

# PostgreSQL Read (Load balanced)
listen postgres-read
    bind *:5433
    balance roundrobin
    option pgsql-check user shahin_admin
    default-server inter 3s fall 3 rise 2
    server pg-primary pg-primary:5432 check
    server pg-replica pg-replica:5432 check
