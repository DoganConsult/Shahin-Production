@*
    SHAHIN AI GRC - Stepper/Wizard Component
    Usage: <partial name="Components/_ShahinStepper" model='new {
        Id = "riskWizard",
        Steps = new[] {
            new { Title = "Basic Info", Icon = "info-circle", Status = "completed" },
            new { Title = "Risk Details", Icon = "shield-check", Status = "active" },
            new { Title = "Mitigation", Icon = "tools", Status = "pending" },
            new { Title = "Review", Icon = "check-circle", Status = "pending" }
        },
        CurrentStep = 2,
        Variant = "default"
    }' />
*@
@{
    dynamic model = ViewData.Model ?? new { };
    var id = model?.Id ?? "shahinStepper" + Guid.NewGuid().ToString("N").Substring(0, 8);
    var steps = model?.Steps as IEnumerable<dynamic> ?? new List<dynamic>();
    var currentStep = model?.CurrentStep ?? 1;
    var variant = model?.Variant ?? "default"; // default, simple, vertical
    var clickable = model?.Clickable ?? false;
}

<div class="shahin-stepper shahin-stepper-@variant" id="@id" data-current-step="@currentStep">
    @{
        var stepList = steps.ToList();
        for (int i = 0; i < stepList.Count; i++)
        {
            var step = stepList[i];
            var title = step.Title?.ToString() ?? $"Step {i + 1}";
            var icon = step.Icon?.ToString() ?? "";
            var description = step.Description?.ToString() ?? "";
            var status = step.Status?.ToString() ?? (i + 1 < currentStep ? "completed" : (i + 1 == currentStep ? "active" : "pending"));
            var stepNumber = i + 1;
            var isLast = i == stepList.Count - 1;

            <div class="shahin-step shahin-step-@status @(clickable ? "clickable" : "")"
                 data-step="@stepNumber"
                 id="@(id)-step-@stepNumber">

                @if (variant != "vertical")
                {
                    <div class="shahin-step-indicator">
                        <div class="shahin-step-number">
                            @if (status == "completed")
                            {
                                <i class="bi bi-check-lg"></i>
                            }
                            else if (!string.IsNullOrEmpty(icon))
                            {
                                <i class="bi bi-@icon"></i>
                            }
                            else
                            {
                                @stepNumber
                            }
                        </div>

                        @if (!isLast && variant == "default")
                        {
                            <div class="shahin-step-connector"></div>
                        }
                    </div>
                }

                <div class="shahin-step-content">
                    @if (variant == "vertical")
                    {
                        <div class="shahin-step-indicator-vertical">
                            <div class="shahin-step-number">
                                @if (status == "completed")
                                {
                                    <i class="bi bi-check-lg"></i>
                                }
                                else if (!string.IsNullOrEmpty(icon))
                                {
                                    <i class="bi bi-@icon"></i>
                                }
                                else
                                {
                                    @stepNumber
                                }
                            </div>
                            @if (!isLast)
                            {
                                <div class="shahin-step-connector-vertical"></div>
                            }
                        </div>
                    }

                    <div class="shahin-step-text">
                        <div class="shahin-step-title">@title</div>
                        @if (!string.IsNullOrEmpty(description))
                        {
                            <div class="shahin-step-description">@description</div>
                        }
                    </div>
                </div>
            </div>
        }
    }
</div>

<style>
    /* Default Horizontal Stepper */
    .shahin-stepper {
        display: flex;
        width: 100%;
        padding: var(--shahin-space-6) 0;
    }

    .shahin-step {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
    }

    .shahin-step.clickable {
        cursor: pointer;
    }

    .shahin-step-indicator {
        display: flex;
        align-items: center;
        width: 100%;
        margin-bottom: var(--shahin-space-3);
    }

    .shahin-step-number {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: var(--shahin-font-weight-bold);
        font-size: var(--shahin-font-size-base);
        background-color: var(--shahin-gray-200);
        color: var(--shahin-gray-600);
        border: 2px solid var(--shahin-gray-300);
        transition: all var(--shahin-transition-base);
        flex-shrink: 0;
    }

    .shahin-step-active .shahin-step-number {
        background-color: var(--shahin-primary);
        color: var(--shahin-white);
        border-color: var(--shahin-primary);
        box-shadow: 0 0 0 4px var(--shahin-primary-light);
    }

    .shahin-step-completed .shahin-step-number {
        background-color: var(--shahin-success);
        color: var(--shahin-white);
        border-color: var(--shahin-success);
    }

    .shahin-step-connector {
        flex: 1;
        height: 2px;
        background-color: var(--shahin-gray-300);
        margin: 0 var(--shahin-space-2);
        transition: background-color var(--shahin-transition-base);
    }

    .shahin-step-completed .shahin-step-connector {
        background-color: var(--shahin-success);
    }

    .shahin-step-content {
        text-align: center;
    }

    .shahin-step-title {
        font-size: var(--shahin-font-size-sm);
        font-weight: var(--shahin-font-weight-semibold);
        color: var(--shahin-gray-700);
        margin-bottom: var(--shahin-space-1);
    }

    .shahin-step-active .shahin-step-title {
        color: var(--shahin-primary);
    }

    .shahin-step-description {
        font-size: var(--shahin-font-size-xs);
        color: var(--shahin-gray-600);
    }

    /* Vertical Stepper */
    .shahin-stepper-vertical {
        flex-direction: column;
    }

    .shahin-stepper-vertical .shahin-step {
        flex-direction: row;
        align-items: flex-start;
        text-align: left;
    }

    .shahin-stepper-vertical .shahin-step-content {
        display: flex;
        flex-direction: row;
        flex: 1;
        text-align: left;
    }

    .shahin-step-indicator-vertical {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-right: var(--shahin-space-4);
    }

    .shahin-step-connector-vertical {
        width: 2px;
        flex: 1;
        min-height: 2rem;
        background-color: var(--shahin-gray-300);
        margin: var(--shahin-space-2) 0;
    }

    .shahin-step-completed .shahin-step-connector-vertical {
        background-color: var(--shahin-success);
    }

    .shahin-stepper-vertical .shahin-step-text {
        flex: 1;
        padding-bottom: var(--shahin-space-4);
    }

    /* Simple Stepper */
    .shahin-stepper-simple .shahin-step-description {
        display: none;
    }

    /* Responsive */
    @@media (max-width: 768px) {
        .shahin-stepper:not(.shahin-stepper-vertical) {
            flex-direction: column;
        }

        .shahin-stepper:not(.shahin-stepper-vertical) .shahin-step {
            flex-direction: row;
            align-items: center;
            text-align: left;
        }

        .shahin-stepper:not(.shahin-stepper-vertical) .shahin-step-indicator {
            flex-direction: column;
            width: auto;
            margin-right: var(--shahin-space-4);
            margin-bottom: 0;
        }

        .shahin-stepper:not(.shahin-stepper-vertical) .shahin-step-connector {
            width: 2px;
            height: 2rem;
            margin: var(--shahin-space-2) 0;
        }

        .shahin-stepper:not(.shahin-stepper-vertical) .shahin-step-content {
            text-align: left;
        }
    }

    [dir="rtl"] .shahin-step-indicator-vertical {
        margin-right: 0;
        margin-left: var(--shahin-space-4);
    }
</style>

@if (clickable)
{
    @section Scripts {
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                var stepper = document.getElementById('@id');
                if (!stepper) return;

                var steps = stepper.querySelectorAll('.shahin-step.clickable');
                steps.forEach(function(step) {
                    step.addEventListener('click', function() {
                        var stepNumber = parseInt(this.getAttribute('data-step'));
                        console.log('Step clicked:', stepNumber);
                        // Trigger custom event for step change
                        var event = new CustomEvent('stepChange', { detail: { step: stepNumber } });
                        stepper.dispatchEvent(event);
                    });
                });
            });
        </script>
    }
}
