@*
    SHAHIN AI GRC - Dropdown Component
    Usage: <partial name="Components/_ShahinDropdown" model='new {
        Id = "myDropdown",
        ButtonText = "Actions",
        ButtonType = "secondary",
        ButtonSize = "md",
        Items = new[] {
            new { Text = "View", Icon = "eye", Url = "#view", Divider = false },
            new { Text = "Edit", Icon = "pencil", Url = "#edit", Divider = false },
            new { Text = "", Icon = "", Url = "", Divider = true },
            new { Text = "Delete", Icon = "trash", Url = "#delete", Divider = false }
        }
    }' />
*@
@{
    dynamic model = ViewData.Model ?? new { };
    var id = model?.Id ?? "shahinDropdown" + Guid.NewGuid().ToString("N").Substring(0, 8);
    var buttonText = model?.ButtonText ?? "Actions";
    var buttonType = model?.ButtonType ?? "secondary";
    var buttonSize = model?.ButtonSize ?? "md";
    var buttonIcon = model?.ButtonIcon ?? "";
    var items = model?.Items as IEnumerable<dynamic> ?? new List<dynamic>();
    var direction = model?.Direction ?? "down"; // down, up, start, end
    var split = model?.Split ?? false;

    var btnClass = $"shahin-btn shahin-btn-{buttonType}";
    if (buttonSize == "sm") btnClass += " shahin-btn-sm";
    else if (buttonSize == "lg") btnClass += " shahin-btn-lg";
    else if (buttonSize == "xl") btnClass += " shahin-btn-xl";

    var dropdownClass = direction switch
    {
        "up" => "dropup",
        "end" => "dropend",
        "start" => "dropstart",
        _ => "dropdown"
    };
}

<div class="@dropdownClass shahin-dropdown">
    @if (split)
    {
        <button type="button" class="@btnClass">
            @if (!string.IsNullOrEmpty(buttonIcon))
            {
                <i class="bi bi-@buttonIcon"></i>
            }
            @buttonText
        </button>
        <button type="button" class="@btnClass dropdown-toggle dropdown-toggle-split"
                data-bs-toggle="dropdown" aria-expanded="false" id="@id">
            <span class="visually-hidden">Toggle Dropdown</span>
        </button>
    }
    else
    {
        <button class="@btnClass dropdown-toggle"
                type="button"
                id="@id"
                data-bs-toggle="dropdown"
                aria-expanded="false">
            @if (!string.IsNullOrEmpty(buttonIcon))
            {
                <i class="bi bi-@buttonIcon me-2"></i>
            }
            @buttonText
        </button>
    }

    <ul class="dropdown-menu shahin-dropdown-menu" aria-labelledby="@id">
        @foreach (var item in items)
        {
            var divider = item.Divider != null && (bool)item.Divider;
            if (divider)
            {
                <li><hr class="dropdown-divider shahin-dropdown-divider" /></li>
            }
            else
            {
                var text = item.Text?.ToString() ?? "";
                var icon = item.Icon?.ToString() ?? "";
                var url = item.Url?.ToString() ?? "#";
                var disabled = item.Disabled != null && (bool)item.Disabled;
                var onclick = item.OnClick?.ToString() ?? "";

                <li>
                    <a class="dropdown-item shahin-dropdown-item @(disabled ? "disabled" : "")"
                       href="@url"
                       @(disabled ? Html.Raw("aria-disabled=\"true\" tabindex=\"-1\"") : null)
                       @(!string.IsNullOrEmpty(onclick) ? Html.Raw($"onclick=\"{onclick}\"") : null)>
                        @if (!string.IsNullOrEmpty(icon))
                        {
                            <i class="bi bi-@icon me-2"></i>
                        }
                        @text
                    </a>
                </li>
            }
        }
    </ul>
</div>

<style>
    .shahin-dropdown-menu {
        background-color: var(--shahin-white);
        border: 1px solid var(--shahin-gray-200);
        border-radius: var(--shahin-radius-base);
        box-shadow: var(--shahin-shadow-lg);
        padding: var(--shahin-space-2);
        min-width: 200px;
        z-index: var(--shahin-z-dropdown);
    }

    .shahin-dropdown-item {
        display: flex;
        align-items: center;
        padding: var(--shahin-space-3) var(--shahin-space-4);
        font-size: var(--shahin-font-size-sm);
        color: var(--shahin-gray-700);
        text-decoration: none;
        border-radius: var(--shahin-radius-sm);
        transition: all var(--shahin-transition-fast);
        cursor: pointer;
    }

    .shahin-dropdown-item:hover:not(.disabled) {
        background-color: var(--shahin-primary-light);
        color: var(--shahin-primary-dark);
    }

    .shahin-dropdown-item.disabled {
        color: var(--shahin-gray-400);
        cursor: not-allowed;
        opacity: 0.5;
    }

    .shahin-dropdown-divider {
        height: 1px;
        background-color: var(--shahin-gray-200);
        margin: var(--shahin-space-2) 0;
        border: none;
    }

    [dir="rtl"] .shahin-dropdown-menu {
        text-align: right;
    }

    [dir="rtl"] .shahin-dropdown-item {
        flex-direction: row-reverse;
    }

    [dir="rtl"] .shahin-dropdown-item i {
        margin-right: 0;
        margin-left: var(--shahin-space-2);
    }
</style>
