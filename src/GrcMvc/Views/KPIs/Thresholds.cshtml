@using Microsoft.AspNetCore.Mvc.Localization
@inject IHtmlLocalizer<SharedResource> L
@{
    ViewData["Title"] = "KPI Thresholds";
    Layout = "_Layout";
}

<div class="container-fluid">
    <div class="row mb-4">
        <div class="col">
            <h2><i class="bi bi-sliders"></i> KPI Thresholds Configuration</h2>
            <p class="text-muted">Configure target thresholds and alert levels for KPIs</p>
        </div>
        <div class="col text-end">
            <a asp-action="Management" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left"></i> Back to KPIs
            </a>
            <a asp-action="Dashboard" class="btn btn-outline-primary">
                <i class="bi bi-speedometer2"></i> Dashboard
            </a>
        </div>
    </div>

    <form asp-action="Thresholds" method="post">
        @Html.AntiForgeryToken()

        <div class="row">
            <div class="col-md-8">
                <div class="card shadow-sm mb-4">
                    <div class="card-header">
                        <i class="bi bi-bullseye"></i> Target Thresholds
                    </div>
                    <div class="card-body">
                        <p class="text-muted small mb-4">
                            Set target values for each KPI. Values below the warning threshold will trigger alerts.
                        </p>

                        <div class="table-responsive">
                            <table class="table">
                                <thead class="table-light">
                                    <tr>
                                        <th>KPI</th>
                                        <th>Target (%)</th>
                                        <th>Warning (%)</th>
                                        <th>Critical (%)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
                                        var kpiConfigs = new[] {
                                            ("ComplianceRate", "Compliance Rate", 90, 70, 50),
                                            ("RiskMitigationRate", "Risk Mitigation Rate", 85, 65, 45),
                                            ("ControlEffectiveness", "Control Effectiveness", 85, 65, 45),
                                            ("PolicyCompliance", "Policy Compliance", 90, 70, 50),
                                            ("AuditFindingsResolved", "Audit Findings Resolved", 95, 75, 50),
                                            ("IncidentResponseTime", "Incident Response Time", 90, 70, 50),
                                            ("TrainingCompletion", "Training Completion", 95, 80, 60),
                                            ("AssessmentCoverage", "Assessment Coverage", 100, 80, 60),
                                            ("VendorCompliance", "Vendor Compliance", 90, 70, 50),
                                            ("DataProtectionScore", "Data Protection Score", 95, 75, 55)
                                        };
                                    }
                                    @foreach (var (key, name, target, warning, critical) in kpiConfigs)
                                    {
                                        <tr>
                                            <td>
                                                <strong>@name</strong>
                                            </td>
                                            <td>
                                                <div class="input-group input-group-sm" style="width: 120px;">
                                                    <input type="number" name="@(key)_Target" class="form-control"
                                                           value="@target" min="0" max="100" />
                                                    <span class="input-group-text">%</span>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="input-group input-group-sm" style="width: 120px;">
                                                    <input type="number" name="@(key)_Warning" class="form-control text-warning"
                                                           value="@warning" min="0" max="100" />
                                                    <span class="input-group-text">%</span>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="input-group input-group-sm" style="width: 120px;">
                                                    <input type="number" name="@(key)_Critical" class="form-control text-danger"
                                                           value="@critical" min="0" max="100" />
                                                    <span class="input-group-text">%</span>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Alert Settings -->
                <div class="card shadow-sm">
                    <div class="card-header">
                        <i class="bi bi-bell"></i> Alert Settings
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Alert Frequency</label>
                                <select name="AlertFrequency" class="form-select">
                                    <option value="Immediate">Immediate</option>
                                    <option value="Daily" selected>Daily Summary</option>
                                    <option value="Weekly">Weekly Summary</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Alert Recipients</label>
                                <input type="text" name="AlertRecipients" class="form-control"
                                       placeholder="email@example.com, email2@example.com" />
                            </div>
                        </div>

                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" name="AlertOnWarning" id="alertWarning" checked />
                            <label class="form-check-label" for="alertWarning">
                                Alert when KPI drops below <span class="text-warning">Warning</span> threshold
                            </label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" name="AlertOnCritical" id="alertCritical" checked />
                            <label class="form-check-label" for="alertCritical">
                                Alert when KPI drops below <span class="text-danger">Critical</span> threshold
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="AlertOnImprovement" id="alertImprovement" />
                            <label class="form-check-label" for="alertImprovement">
                                Alert when KPI improves above target (positive notification)
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <!-- Legend -->
                <div class="card mb-4">
                    <div class="card-header">
                        <i class="bi bi-info-circle"></i> Threshold Legend
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <span class="badge bg-success me-2">Target</span>
                                The desired performance level
                            </li>
                            <li class="mb-2">
                                <span class="badge bg-warning me-2">Warning</span>
                                Needs attention - below optimal
                            </li>
                            <li>
                                <span class="badge bg-danger me-2">Critical</span>
                                Requires immediate action
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Preview -->
                <div class="card mb-4">
                    <div class="card-header">
                        <i class="bi bi-eye"></i> Status Preview
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <div class="d-flex justify-content-between small mb-1">
                                <span>0%</span>
                                <span>50%</span>
                                <span>100%</span>
                            </div>
                            <div class="d-flex" style="height: 30px;">
                                <div class="bg-danger flex-fill" style="width: 50%;" title="Critical"></div>
                                <div class="bg-warning flex-fill" style="width: 20%;" title="Warning"></div>
                                <div class="bg-success flex-fill" style="width: 30%;" title="On Target"></div>
                            </div>
                            <div class="d-flex justify-content-between small mt-1 text-muted">
                                <span>Critical</span>
                                <span>Warning</span>
                                <span>Target</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="card">
                    <div class="card-body d-grid gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-check-circle"></i> Save Thresholds
                        </button>
                        <button type="reset" class="btn btn-outline-secondary">
                            <i class="bi bi-arrow-counterclockwise"></i> Reset to Defaults
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
