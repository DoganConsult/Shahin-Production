@model WizardSummaryDto
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer

@{
    var tenantId = Model.TenantId;
    var completedSteps = Model.Steps.Count(s => s.IsCompleted);
    var totalSteps = Model.Steps.Count;
    var remainingSteps = totalSteps - completedSteps;
    var estimatedMinutesPerStep = 4;
    var estimatedMinutesRemaining = remainingSteps * estimatedMinutesPerStep;

    // Step time estimates (in minutes)
    var stepTimes = new Dictionary<int, int> {
        { 1, 4 }, { 2, 3 }, { 3, 4 }, { 4, 5 }, { 5, 4 }, { 6, 5 },
        { 7, 4 }, { 8, 5 }, { 9, 4 }, { 10, 3 }, { 11, 3 }, { 12, 4 }
    };
}

<div class="wizard-sidebar bg-light border-end" style="min-height: 100vh; width: 280px;">
    <div class="p-4">
        <h5 class="mb-3">
            <i class="fas fa-rocket text-primary me-2"></i>
            @Localizer["Wizard_Sidebar_Title"]
        </h5>

        <!-- Enhanced Progress Section -->
        <div class="mb-4 progress-section">
            <div class="d-flex justify-content-between mb-1">
                <small class="text-muted">@Localizer["Wizard_Progress"]</small>
                <small class="text-primary fw-bold">@Model.ProgressPercent%</small>
            </div>
            <div class="progress" style="height: 10px; border-radius: 10px;">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                     style="width: @Model.ProgressPercent%; background: linear-gradient(90deg, #10B981, #3B82F6);"
                     aria-valuenow="@Model.ProgressPercent" aria-valuemin="0" aria-valuemax="100">
                </div>
            </div>

            <!-- Progress Milestones -->
            <div class="progress-milestones mt-2">
                @for (int i = 0; i < totalSteps; i++)
                {
                    var isCompleted = i < completedSteps;
                    var isCurrent = i == completedSteps;
                    <span class="milestone @(isCompleted ? "completed" : "") @(isCurrent ? "current" : "")"
                          title="Step @(i + 1)"></span>
                }
            </div>

            <!-- Steps Counter -->
            <div class="steps-counter mt-2 text-center">
                <span class="badge bg-primary">@Localizer["Wizard_StepsCompleted", completedSteps, totalSteps]</span>
            </div>
        </div>

        <!-- Time Estimate -->
        @if (remainingSteps > 0)
        {
            <div class="time-estimate-card mb-4">
                <div class="time-estimate-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="time-estimate-content">
                    <div class="time-value">~@estimatedMinutesRemaining min</div>
                    <div class="time-label">@Localizer["Wizard_EstimatedRemaining"]</div>
                </div>
            </div>
        }
        else
        {
            <div class="completion-card mb-4">
                <div class="completion-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <div class="completion-content">
                    <div class="completion-title">@Localizer["Wizard_AlmostDone"]</div>
                    <div class="completion-label">@Localizer["Wizard_ReviewFinalize"]</div>
                </div>
            </div>
        }

        <!-- Steps Navigation -->
        <nav class="wizard-steps">
            @foreach (var step in Model.Steps)
            {
                var statusClass = step.IsCompleted ? "completed" : step.IsCurrent ? "current" : step.IsLocked ? "locked" : "";
                var iconClass = step.IsCompleted ? "fa-check-circle text-success" :
                               step.IsCurrent ? "fa-play-circle text-primary" :
                               step.IsLocked ? "fa-lock text-muted" : "fa-circle text-muted";
                var stepTime = stepTimes.ContainsKey(step.StepNumber) ? stepTimes[step.StepNumber] : 4;

                <a href="@(step.IsLocked ? "#" : Url.Action($"Step{(char)('A' + step.StepNumber - 1)}", "OnboardingWizard", new { tenantId }))"
                   class="wizard-step d-block p-2 mb-1 rounded text-decoration-none @statusClass @(step.IsLocked ? "disabled" : "")"
                   title="@(step.IsLocked ? "Complete previous steps first" : step.StepName)">
                    <div class="d-flex align-items-center">
                        <span class="step-icon me-2">
                            <i class="fas @iconClass"></i>
                        </span>
                        <div class="flex-grow-1">
                            <div class="step-header d-flex justify-content-between">
                                <span class="step-number text-muted small">Step @step.StepNumber</span>
                                @if (!step.IsCompleted && !step.IsLocked)
                                {
                                    <span class="step-time text-muted small">~@stepTime min</span>
                                }
                            </div>
                            <div class="step-name @(step.IsCurrent ? "fw-bold text-primary" : "text-dark")">
                                @step.StepName
                            </div>
                        </div>
                        @if (step.IsCompleted)
                        {
                            <span class="badge bg-success ms-1 step-badge">
                                <i class="fas fa-check"></i>
                            </span>
                        }
                        else if (step.IsCurrent)
                        {
                            <span class="badge bg-primary ms-1 step-badge pulse-badge">
                                <i class="fas fa-arrow-right"></i>
                            </span>
                        }
                    </div>
                </a>
            }
        </nav>

        <!-- Quick Actions -->
        <div class="mt-4 pt-3 border-top quick-actions">
            <form asp-action="SaveAndExit" asp-route-tenantId="@tenantId" method="post">
                @Html.AntiForgeryToken()
                <button type="submit" class="btn btn-outline-secondary btn-sm w-100 mb-2 action-btn">
                    <i class="fas fa-save me-1"></i> @Localizer["Wizard_SaveExit"]
                </button>
            </form>
            <a href="@Url.Action("Summary", "OnboardingWizard", new { tenantId })"
               class="btn btn-outline-info btn-sm w-100 action-btn">
                <i class="fas fa-list-alt me-1"></i> @Localizer["Wizard_ViewSummary"]
            </a>
        </div>

        <!-- Motivation Quote -->
        <div class="motivation-quote mt-4 pt-3 border-top">
            <small class="text-muted">
                <i class="fas fa-quote-left me-1"></i>
                @{
                    var quotes = new[] {
                        "Great compliance starts with great onboarding!",
                        "Each step brings you closer to audit readiness.",
                        "Building a strong foundation for your GRC program.",
                        "Your compliance journey is progressing well!"
                    };
                    var randomQuote = quotes[new Random().Next(quotes.Length)];
                }
                @randomQuote
            </small>
        </div>
    </div>
</div>

<style>
    .wizard-sidebar {
        position: sticky;
        top: 0;
    }

    /* Progress Milestones */
    .progress-milestones {
        display: flex;
        justify-content: space-between;
        padding: 0 2px;
    }

    .milestone {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #CBD5E1;
        transition: all 0.3s ease;
    }

    .milestone.completed {
        background: #10B981;
        box-shadow: 0 0 6px rgba(16, 185, 129, 0.5);
    }

    .milestone.current {
        background: #3B82F6;
        box-shadow: 0 0 8px rgba(59, 130, 246, 0.6);
        transform: scale(1.3);
        animation: milestonePulse 1.5s infinite;
    }

    @@keyframes milestonePulse {
        0%, 100% { box-shadow: 0 0 4px rgba(59, 130, 246, 0.4); }
        50% { box-shadow: 0 0 12px rgba(59, 130, 246, 0.8); }
    }

    /* Time Estimate Card */
    .time-estimate-card {
        display: flex;
        align-items: center;
        gap: 12px;
        background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(251, 191, 36, 0.05));
        border: 1px solid rgba(245, 158, 11, 0.2);
        border-radius: 12px;
        padding: 12px;
    }

    .time-estimate-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(245, 158, 11, 0.15);
        border-radius: 10px;
        color: #F59E0B;
        font-size: 1.2rem;
    }

    .time-estimate-content .time-value {
        font-weight: 700;
        font-size: 1.1rem;
        color: #D97706;
    }

    .time-estimate-content .time-label {
        font-size: 0.75rem;
        color: #92400E;
    }

    /* Completion Card */
    .completion-card {
        display: flex;
        align-items: center;
        gap: 12px;
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(52, 211, 153, 0.05));
        border: 1px solid rgba(16, 185, 129, 0.2);
        border-radius: 12px;
        padding: 12px;
    }

    .completion-icon {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: rgba(16, 185, 129, 0.15);
        border-radius: 10px;
        color: #10B981;
        font-size: 1.2rem;
    }

    .completion-content .completion-title {
        font-weight: 700;
        font-size: 1.1rem;
        color: #059669;
    }

    .completion-content .completion-label {
        font-size: 0.75rem;
        color: #065F46;
    }

    /* Wizard Steps */
    .wizard-step {
        transition: background-color var(--wz-base, 180ms) var(--wz-ease, cubic-bezier(.2,.8,.2,1)),
                    transform var(--wz-base, 180ms) var(--wz-ease, cubic-bezier(.2,.8,.2,1)),
                    border-color var(--wz-base, 180ms) var(--wz-ease, cubic-bezier(.2,.8,.2,1));
        border-left: 3px solid transparent;
    }

    .wizard-step:hover:not(.disabled) {
        background-color: rgba(59, 130, 246, 0.08);
        border-left-color: #3B82F6;
        transform: translateX(3px);
    }

    .wizard-step.current {
        background-color: rgba(59, 130, 246, 0.12);
        border-left-color: #3B82F6;
    }

    .wizard-step.completed {
        background-color: rgba(16, 185, 129, 0.08);
        border-left-color: #10B981;
    }

    .wizard-step.disabled {
        cursor: not-allowed;
        opacity: 0.5;
    }

    .step-icon {
        width: 24px;
        text-align: center;
    }

    .step-badge {
        width: 22px;
        height: 22px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-size: 0.7rem;
        padding: 0;
    }

    .pulse-badge {
        animation: badgePulse 1.5s infinite;
    }

    @@keyframes badgePulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    .step-time {
        font-size: 0.7rem;
        opacity: 0.7;
    }

    /* Quick Actions */
    .action-btn {
        transition: all 0.2s ease;
        border-radius: 8px;
    }

    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    /* Motivation Quote */
    .motivation-quote {
        font-style: italic;
        padding: 8px 0;
        line-height: 1.5;
    }

    .motivation-quote .fa-quote-left {
        opacity: 0.5;
    }

    /* Reduce Motion - Accessibility */
    @@media (prefers-reduced-motion: reduce) {
        .progress-bar-animated {
            animation: none !important;
        }
        .pulse-badge {
            animation: none !important;
        }
        .milestone.current {
            animation: none !important;
            transform: none !important;
        }
        .wizard-step {
            transition-duration: 1ms !important;
        }
    }
</style>
