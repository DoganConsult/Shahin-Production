@using Microsoft.AspNetCore.Html
@{
    ViewData["Title"] = ViewData["AgentName"];
    var agentCode = ViewData["AgentCode"] as string;
    var agentName = ViewData["AgentName"] as string;
    var agentRole = ViewData["AgentRole"] as string;
    var oversightBy = ViewData["OversightBy"] as string;

    var overviewContent = GetOverviewContent();
    var chatContent = GetChatContent(agentName, agentCode);
    var configContent = GetConfigContent(oversightBy);
    var analyticsContent = GetAnalyticsContent();
    var historyContent = GetHistoryContent();
    var workflowBuilderContent = GetWorkflowBuilderContent();
}

<div class="container-fluid py-4">
    <!-- Breadcrumb -->
    <partial name="Components/_ShahinBreadcrumb" model='new {
        Items = new[] {
            new { Text = "Agents", Url = "/Agent" },
            new { Text = agentName, Url = "" }
        }
    }' />

    <!-- Agent Header -->
    <div class="agent-detail-header mb-5">
        <div class="row align-items-center">
            <div class="col-md-8">
                <div class="d-flex align-items-center gap-4">
                    <partial name="Components/_ShahinAvatar" model='new {
                        Name = agentName,
                        Size = "xxl",
                        Status = "online",
                        ShowBadge = true,
                        Badge = "\u26A1"
                    }' />
                    <div>
                        <div class="d-flex align-items-center gap-3 mb-2">
                            <h1 class="display-5 mb-0">@agentName</h1>
                            <span class="shahin-badge shahin-badge-success">
                                <i class="bi bi-circle-fill" style="font-size: 0.5rem;"></i>
                                Online
                            </span>
                        </div>
                        <p class="text-muted fs-5 mb-2">@agentRole</p>
                        <p class="text-muted">
                            <i class="bi bi-shield-check"></i>
                            Oversight: <strong>@oversightBy</strong>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 text-end">
                <button class="shahin-btn shahin-btn-lg shahin-btn-primary mb-2">
                    <i class="bi bi-chat-dots-fill"></i>
                    Start Conversation
                </button>
                <br />
                <button class="shahin-btn shahin-btn-secondary">
                    <i class="bi bi-gear-fill"></i>
                    Configure Agent
                </button>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <partial name="Components/_ShahinTabs" model='new {
        Id = "agentTabs",
        Variant = "pills",
        Tabs = new[] {
            new { Title = "Overview", Icon = "house", Active = true, Content = overviewContent },
            new { Title = "Chat Interface", Icon = "chat-dots", Active = false, Content = chatContent },
            new { Title = "Configuration", Icon = "gear", Active = false, Content = configContent },
            new { Title = "Analytics", Icon = "graph-up", Active = false, Content = analyticsContent },
            new { Title = "History", Icon = "clock-history", Active = false, Content = historyContent },
            new { Title = "Workflow Builder", Icon = "diagram-3", Active = false, Content = workflowBuilderContent }
        }
    }' />

</div>

<style>
    .agent-detail-header {
        background: linear-gradient(135deg, var(--shahin-primary-light), var(--shahin-secondary-light));
        padding: var(--shahin-space-8);
        border-radius: var(--shahin-radius-lg);
        margin-top: var(--shahin-space-4);
    }

    .agent-chat-container {
        background: var(--shahin-white);
        border: 1px solid var(--shahin-gray-200);
        border-radius: var(--shahin-radius-lg);
        height: 600px;
        display: flex;
        flex-direction: column;
    }

    .agent-chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: var(--shahin-space-6);
        display: flex;
        flex-direction: column;
        gap: var(--shahin-space-4);
    }

    .agent-message {
        display: flex;
        gap: var(--shahin-space-3);
    }

    .agent-message-avatar {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        background: var(--shahin-primary-light);
        color: var(--shahin-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: var(--shahin-font-size-lg);
        flex-shrink: 0;
    }

    .agent-message-content {
        flex: 1;
        max-width: 70%;
    }

    .agent-message-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: var(--shahin-space-1);
        font-size: var(--shahin-font-size-sm);
    }

    .agent-message-text {
        background: var(--shahin-gray-50);
        padding: var(--shahin-space-3) var(--shahin-space-4);
        border-radius: var(--shahin-radius-base);
        font-size: var(--shahin-font-size-sm);
        line-height: var(--shahin-line-height-normal);
    }

    .agent-chat-input {
        border-top: 1px solid var(--shahin-gray-200);
        padding: var(--shahin-space-4);
        background: var(--shahin-gray-50);
    }

    /* Workflow Builder Styles */
    .workflow-template-list {
        display: flex;
        flex-direction: column;
        gap: var(--shahin-space-2);
    }

    .workflow-template-item {
        display: flex;
        align-items: center;
        gap: var(--shahin-space-3);
        padding: var(--shahin-space-3);
        border: 1px solid var(--shahin-gray-200);
        border-radius: var(--shahin-radius-base);
        cursor: pointer;
        transition: all 0.2s;
    }

    .workflow-template-item:hover {
        background: var(--shahin-primary-light);
        border-color: var(--shahin-primary);
    }

    .workflow-template-item i {
        font-size: 1.5rem;
        color: var(--shahin-primary);
    }

    .workflow-canvas {
        background: var(--shahin-gray-50);
        border: 2px dashed var(--shahin-gray-300);
        border-radius: var(--shahin-radius-base);
        padding: var(--shahin-space-6);
        min-height: 400px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: var(--shahin-space-2);
    }

    .workflow-node {
        background: var(--shahin-white);
        border: 2px solid var(--shahin-primary);
        border-radius: var(--shahin-radius-base);
        padding: var(--shahin-space-4);
        display: flex;
        align-items: center;
        gap: var(--shahin-space-2);
        cursor: move;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .workflow-node i {
        font-size: 1.25rem;
        color: var(--shahin-primary);
    }

    .workflow-connector {
        width: 2px;
        height: 30px;
        background: var(--shahin-gray-400);
        position: relative;
    }

    .workflow-connector::after {
        content: '';
        position: absolute;
        bottom: -6px;
        left: -4px;
        width: 0;
        height: 0;
        border-left: 5px solid transparent;
        border-right: 5px solid transparent;
        border-top: 8px solid var(--shahin-gray-400);
    }

    .allocation-matrix {
        display: flex;
        flex-direction: column;
        gap: var(--shahin-space-3);
    }

    .allocation-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--shahin-space-3);
        align-items: center;
    }

    .allocation-task {
        font-weight: 500;
    }

    .backup-config {
        padding: var(--shahin-space-4);
        background: var(--shahin-gray-50);
        border-radius: var(--shahin-radius-base);
    }

    .communication-log {
        display: flex;
        flex-direction: column;
        gap: var(--shahin-space-4);
    }

    .log-entry {
        display: flex;
        gap: var(--shahin-space-3);
        padding: var(--shahin-space-4);
        background: var(--shahin-gray-50);
        border-radius: var(--shahin-radius-base);
    }

    .log-badge {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }

    .log-badge-info {
        background: var(--shahin-info-light);
        color: var(--shahin-info);
    }

    .log-badge-success {
        background: var(--shahin-success-light);
        color: var(--shahin-success);
    }

    .log-badge-warning {
        background: var(--shahin-warning-light);
        color: var(--shahin-warning);
    }

    .log-content {
        flex: 1;
    }

    .log-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: var(--shahin-space-1);
    }
</style>

@section Scripts {
    <script>
        function sendMessage() {
            var input = document.getElementById('chatInput');
            var message = input.value.trim();
            if (!message) return;

            var messagesDiv = document.getElementById('chatMessages');

            // Add user message
            var userMsg = document.createElement('div');
            userMsg.className = 'agent-message user';
            userMsg.innerHTML = `
                <div class="agent-message-content">
                    <div class="agent-message-header">
                        <strong>You</strong>
                        <span class="text-muted">Just now</span>
                    </div>
                    <div class="agent-message-text" style="background: var(--shahin-primary-light);">
                        ${message}
                    </div>
                </div>
            `;
            messagesDiv.appendChild(userMsg);

            input.value = '';

            // Scroll to bottom
            messagesDiv.scrollTop = messagesDiv.scrollHeight;

            // Simulate agent response
            setTimeout(function() {
                var agentMsg = document.createElement('div');
                agentMsg.className = 'agent-message assistant';
                agentMsg.innerHTML = `
                    <div class="agent-message-avatar">
                        <i class="bi bi-robot"></i>
                    </div>
                    <div class="agent-message-content">
                        <div class="agent-message-header">
                            <strong>@agentName</strong>
                            <span class="text-muted">Just now</span>
                        </div>
                        <div class="agent-message-text">
                            I'm processing your request: "${message}"
                        </div>
                    </div>
                `;
                messagesDiv.appendChild(agentMsg);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, 1000);
        }

        // Enter to send
        document.getElementById('chatInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Workflow Builder Functions
        function loadTemplate(type) {
            console.log('Loading template:', type);
            alert('Template loaded: ' + type + '\nDrag-and-drop workflow builder will be activated.');
        }

        function addNode() {
            alert('Add Node functionality - will open node type selector');
        }

        function saveWorkflow() {
            alert('Workflow saved successfully!');
        }

        function updateAllocation(select, taskType) {
            console.log('Allocation updated:', taskType, select.value);
            alert('Task allocation updated: ' + taskType + ' â†’ ' + select.value);
        }
    </script>
}

@functions {
    IHtmlContent GetOverviewContent()
    {
        return new HtmlString(@"
            <div class='row g-4'>
                <!-- Performance Stats -->
                <div class='col-md-3'>
                    <div class='stat-card'>
                        <div class='stat-card-icon primary'>
                            <i class='bi bi-diagram-3-fill'></i>
                        </div>
                        <div class='mt-3'>
                            <p class='stat-card-label'>Workflows Automated</p>
                            <h3 class='stat-card-value'>1,234</h3>
                            <p class='stat-card-change positive'>
                                <i class='bi bi-arrow-up'></i> +87 this month
                            </p>
                        </div>
                    </div>
                </div>
                <div class='col-md-3'>
                    <div class='stat-card'>
                        <div class='stat-card-icon success'>
                            <i class='bi bi-shuffle'></i>
                        </div>
                        <div class='mt-3'>
                            <p class='stat-card-label'>Tasks Routed</p>
                            <h3 class='stat-card-value'>5,678</h3>
                            <p class='stat-card-change positive'>
                                <i class='bi bi-arrow-up'></i> +423 routed
                            </p>
                        </div>
                    </div>
                </div>
                <div class='col-md-3'>
                    <div class='stat-card'>
                        <div class='stat-card-icon warning'>
                            <i class='bi bi-clock-fill'></i>
                        </div>
                        <div class='mt-3'>
                            <p class='stat-card-label'>SLA Compliance</p>
                            <h3 class='stat-card-value'>98.4%</h3>
                            <p class='stat-card-change positive'>
                                <i class='bi bi-arrow-up'></i> +1.2%
                            </p>
                        </div>
                    </div>
                </div>
                <div class='col-md-3'>
                    <div class='stat-card'>
                        <div class='stat-card-icon danger'>
                            <i class='bi bi-person-fill-check'></i>
                        </div>
                        <div class='mt-3'>
                            <p class='stat-card-label'>Backup Activations</p>
                            <h3 class='stat-card-value'>23</h3>
                            <p class='stat-card-change neutral'>
                                <i class='bi bi-dash'></i> Auto-delegated
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity Timeline -->
            <div class='mt-5'>
                <h3 class='mb-4'>Recent Activity</h3>
                <div class='shahin-timeline'>
                    <div class='shahin-timeline-item'>
                        <div class='shahin-timeline-marker shahin-timeline-marker-success'>
                            <i class='bi bi-check-circle-fill'></i>
                        </div>
                        <div class='shahin-timeline-content'>
                            <div class='shahin-timeline-header'>
                                <h4 class='shahin-timeline-title'>Workflow Automated Successfully</h4>
                                <span class='shahin-timeline-date'>15 minutes ago</span>
                            </div>
                            <p class='shahin-timeline-description'>Automated compliance review workflow with 5 stages and 3 approval checkpoints</p>
                        </div>
                    </div>
                    <div class='shahin-timeline-item'>
                        <div class='shahin-timeline-marker shahin-timeline-marker-info'>
                            <i class='bi bi-info-circle-fill'></i>
                        </div>
                        <div class='shahin-timeline-content'>
                            <div class='shahin-timeline-header'>
                                <h4 class='shahin-timeline-title'>Tasks Routed to Agents</h4>
                                <span class='shahin-timeline-date'>1 hour ago</span>
                            </div>
                            <p class='shahin-timeline-description'>Distributed 47 tasks across 8 specialized agents based on workload and priority</p>
                        </div>
                    </div>
                    <div class='shahin-timeline-item'>
                        <div class='shahin-timeline-marker shahin-timeline-marker-warning'>
                            <i class='bi bi-exclamation-circle-fill'></i>
                        </div>
                        <div class='shahin-timeline-content'>
                            <div class='shahin-timeline-header'>
                                <h4 class='shahin-timeline-title'>Human Backup Activated</h4>
                                <span class='shahin-timeline-date'>3 hours ago</span>
                            </div>
                            <p class='shahin-timeline-description'>Primary Compliance Officer absent - tasks auto-delegated to backup GRC Manager</p>
                        </div>
                    </div>
                </div>
            </div>
        ");
    }

    IHtmlContent GetChatContent(string agentName, string agentCode)
    {
        return new HtmlString($@"
            <div class='agent-chat-container'>
                <div class='agent-chat-messages' id='chatMessages'>
                    <div class='agent-message assistant'>
                        <div class='agent-message-avatar'>
                            <i class='bi bi-robot'></i>
                        </div>
                        <div class='agent-message-content'>
                            <div class='agent-message-header'>
                                <strong>{agentName}</strong>
                                <span class='text-muted'>2 minutes ago</span>
                            </div>
                            <div class='agent-message-text'>
                                Hello! I'm {agentName} ({agentCode}). I handle task routing, SLA management, process automation, and human backup delegation. How can I assist you today?
                            </div>
                        </div>
                    </div>
                </div>
                <div class='agent-chat-input'>
                    <textarea class='shahin-form-input' rows='3' placeholder='Type your message...' id='chatInput'></textarea>
                    <div class='d-flex justify-content-between mt-3'>
                        <div>
                            <button class='shahin-btn shahin-btn-ghost shahin-btn-sm'>
                                <i class='bi bi-paperclip'></i>
                                Attach
                            </button>
                            <button class='shahin-btn shahin-btn-ghost shahin-btn-sm'>
                                <i class='bi bi-mic-fill'></i>
                                Voice
                            </button>
                        </div>
                        <button class='shahin-btn shahin-btn-primary' onclick='sendMessage()'>
                            <i class='bi bi-send-fill'></i>
                            Send
                        </button>
                    </div>
                </div>
            </div>
        ");
    }

    IHtmlContent GetConfigContent(string oversightBy)
    {
        return new HtmlString($@"
            <div class='row'>
                <div class='col-md-6'>
                    <div class='shahin-card'>
                        <div class='shahin-card-header'>
                            <h4 class='shahin-card-title'>Agent Settings</h4>
                        </div>
                        <div class='shahin-card-body'>
                            <div class='mb-4'>
                                <label class='shahin-form-label'>Temperature</label>
                                <input type='range' class='form-range' min='0' max='1' step='0.1' value='0.7'>
                                <small class='text-muted'>Controls randomness (0 = focused, 1 = creative)</small>
                            </div>
                            <div class='mb-4'>
                                <label class='shahin-form-label'>Max Tokens</label>
                                <input type='number' class='shahin-form-input' value='4096'>
                            </div>
                            <div class='mb-4'>
                                <label class='shahin-form-label'>Context Window</label>
                                <select class='shahin-form-select'>
                                    <option>200K tokens</option>
                                    <option selected>180K tokens (recommended)</option>
                                    <option>100K tokens</option>
                                </select>
                            </div>
                            <div class='shahin-form-check'>
                                <input type='checkbox' class='shahin-form-check-input' id='enableLogging' checked>
                                <label class='shahin-form-check-label' for='enableLogging'>
                                    Enable detailed logging
                                </label>
                            </div>
                        </div>
                        <div class='shahin-card-footer'>
                            <button class='shahin-btn shahin-btn-primary'>Save Configuration</button>
                        </div>
                    </div>
                </div>
                <div class='col-md-6'>
                    <div class='shahin-card'>
                        <div class='shahin-card-header'>
                            <h4 class='shahin-card-title'>Permissions & Access</h4>
                        </div>
                        <div class='shahin-card-body'>
                            <p class='text-muted mb-3'>Who can access this agent:</p>
                            <div class='mb-3'>
                                <div class='shahin-form-check'>
                                    <input type='checkbox' class='shahin-form-check-input' id='role1' checked>
                                    <label class='shahin-form-check-label' for='role1'>Platform Admin</label>
                                </div>
                                <div class='shahin-form-check'>
                                    <input type='checkbox' class='shahin-form-check-input' id='role2' checked>
                                    <label class='shahin-form-check-label' for='role2'>{oversightBy}</label>
                                </div>
                                <div class='shahin-form-check'>
                                    <input type='checkbox' class='shahin-form-check-input' id='role3'>
                                    <label class='shahin-form-check-label' for='role3'>GRC Manager</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        ");
    }

    IHtmlContent GetAnalyticsContent()
    {
        return new HtmlString(@"
            <div class='row g-4'>
                <div class='col-12'>
                    <div class='shahin-card'>
                        <div class='shahin-card-header'>
                            <h4 class='shahin-card-title'>Workflow Automation Trends (Last 30 Days)</h4>
                        </div>
                        <div class='shahin-card-body'>
                            <p class='text-center text-muted py-5'>
                                <i class='bi bi-graph-up' style='font-size: 3rem;'></i><br />
                                Chart.js visualization will be rendered here
                            </p>
                        </div>
                    </div>
                </div>
                <div class='col-md-6'>
                    <div class='shahin-card'>
                        <div class='shahin-card-header'>
                            <h4 class='shahin-card-title'>Workflow Performance</h4>
                        </div>
                        <div class='shahin-card-body'>
                            <div class='mb-3'>
                                <div class='d-flex justify-content-between mb-2'>
                                    <span>Automated Successfully</span>
                                    <strong>94%</strong>
                                </div>
                                <div class='shahin-progress'><div class='shahin-progress-bar shahin-progress-bar-success' style='width: 94%'></div></div>
                            </div>
                            <div class='mb-3'>
                                <div class='d-flex justify-content-between mb-2'>
                                    <span>Requires Review</span>
                                    <strong>4%</strong>
                                </div>
                                <div class='shahin-progress'><div class='shahin-progress-bar shahin-progress-bar-warning' style='width: 4%'></div></div>
                            </div>
                            <div>
                                <div class='d-flex justify-content-between mb-2'>
                                    <span>Failed</span>
                                    <strong>2%</strong>
                                </div>
                                <div class='shahin-progress'><div class='shahin-progress-bar shahin-progress-bar-danger' style='width: 2%'></div></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class='col-md-6'>
                    <div class='shahin-card'>
                        <div class='shahin-card-header'>
                            <h4 class='shahin-card-title'>Top Collaborators</h4>
                        </div>
                        <div class='shahin-card-body'>
                            <p class='text-muted'>Other agents this agent frequently works with:</p>
                            <div class='d-flex flex-column gap-2'>
                                <div class='d-flex justify-content-between'>
                                    <span>SUPPORT_AGENT</span>
                                    <span class='shahin-badge shahin-badge-warning'>712 tasks</span>
                                </div>
                                <div class='d-flex justify-content-between'>
                                    <span>EMAIL_AGENT</span>
                                    <span class='shahin-badge shahin-badge-success'>645 tasks</span>
                                </div>
                                <div class='d-flex justify-content-between'>
                                    <span>SHAHIN_AI</span>
                                    <span class='shahin-badge shahin-badge-info'>589 tasks</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        ");
    }

    IHtmlContent GetHistoryContent()
    {
        return new HtmlString(@"
            <div class='shahin-card'>
                <div class='shahin-card-header'>
                    <h4 class='shahin-card-title'>Task History</h4>
                </div>
                <div class='shahin-card-body'>
                    <div class='shahin-table-container'>
                        <table class='shahin-table'>
                            <thead>
                                <tr>
                                    <th>Task ID</th>
                                    <th>Type</th>
                                    <th>Status</th>
                                    <th>Duration</th>
                                    <th>Timestamp</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>WF-1234</td>
                                    <td>Workflow Automation</td>
                                    <td><span class='shahin-badge shahin-badge-success'>Completed</span></td>
                                    <td>3.2s</td>
                                    <td>2024-01-15 15:17</td>
                                </tr>
                                <tr>
                                    <td>WF-1233</td>
                                    <td>Task Routing</td>
                                    <td><span class='shahin-badge shahin-badge-success'>Completed</span></td>
                                    <td>1.8s</td>
                                    <td>2024-01-15 14:30</td>
                                </tr>
                                <tr>
                                    <td>WF-1232</td>
                                    <td>Backup Activation</td>
                                    <td><span class='shahin-badge shahin-badge-warning'>Active</span></td>
                                    <td>-</td>
                                    <td>2024-01-15 12:45</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        ");
    }

    IHtmlContent GetWorkflowBuilderContent()
    {
        return new HtmlString(@"
            <div class='row g-4'>
                <!-- Workflow Templates -->
                <div class='col-md-4'>
                    <div class='shahin-card'>
                        <div class='shahin-card-header'>
                            <h4 class='shahin-card-title'>
                                <i class='bi bi-collection'></i> Workflow Templates
                            </h4>
                        </div>
                        <div class='shahin-card-body'>
                            <div class='workflow-template-list'>
                                <div class='workflow-template-item' onclick=""loadTemplate('compliance')"">
                                    <i class='bi bi-shield-check'></i>
                                    <div>
                                        <strong>Compliance Review</strong>
                                        <small class='d-block text-muted'>Standard compliance workflow</small>
                                    </div>
                                </div>
                                <div class='workflow-template-item' onclick=""loadTemplate('risk')"">
                                    <i class='bi bi-exclamation-triangle'></i>
                                    <div>
                                        <strong>Risk Assessment</strong>
                                        <small class='d-block text-muted'>Multi-stage risk evaluation</small>
                                    </div>
                                </div>
                                <div class='workflow-template-item' onclick=""loadTemplate('audit')"">
                                    <i class='bi bi-clipboard-check'></i>
                                    <div>
                                        <strong>Audit Process</strong>
                                        <small class='d-block text-muted'>Complete audit lifecycle</small>
                                    </div>
                                </div>
                                <div class='workflow-template-item' onclick=""loadTemplate('custom')"">
                                    <i class='bi bi-plus-circle'></i>
                                    <div>
                                        <strong>Create Custom</strong>
                                        <small class='d-block text-muted'>Build from scratch</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Workflow Designer -->
                <div class='col-md-8'>
                    <div class='shahin-card'>
                        <div class='shahin-card-header'>
                            <h4 class='shahin-card-title'>
                                <i class='bi bi-pen'></i> Workflow Designer
                            </h4>
                        </div>
                        <div class='shahin-card-body'>
                            <div class='workflow-canvas' id='workflowCanvas'>
                                <div class='workflow-node' data-type='start'>
                                    <i class='bi bi-play-circle'></i>
                                    <span>Start</span>
                                </div>
                                <div class='workflow-connector'></div>
                                <div class='workflow-node' data-type='action'>
                                    <i class='bi bi-gear'></i>
                                    <span>Task Assignment</span>
                                </div>
                                <div class='workflow-connector'></div>
                                <div class='workflow-node' data-type='decision'>
                                    <i class='bi bi-question-diamond'></i>
                                    <span>Review Required?</span>
                                </div>
                                <div class='workflow-connector'></div>
                                <div class='workflow-node' data-type='end'>
                                    <i class='bi bi-check-circle'></i>
                                    <span>Complete</span>
                                </div>
                            </div>
                            <div class='mt-3 d-flex gap-2'>
                                <button class='shahin-btn shahin-btn-sm shahin-btn-primary' onclick='addNode()'>
                                    <i class='bi bi-plus'></i> Add Node
                                </button>
                                <button class='shahin-btn shahin-btn-sm shahin-btn-secondary' onclick='saveWorkflow()'>
                                    <i class='bi bi-save'></i> Save Workflow
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Task Allocation Matrix -->
                <div class='col-md-6'>
                    <div class='shahin-card'>
                        <div class='shahin-card-header'>
                            <h4 class='shahin-card-title'>
                                <i class='bi bi-people'></i> Task Allocation Matrix
                            </h4>
                        </div>
                        <div class='shahin-card-body'>
                            <div class='allocation-matrix'>
                                <div class='allocation-row'>
                                    <div class='allocation-task'>Compliance Review</div>
                                    <select class='shahin-form-select' onchange=""updateAllocation(this, 'compliance')"">
                                        <option value='COMPLIANCE_AGENT' selected>COMPLIANCE_AGENT</option>
                                        <option value='AUDIT_AGENT'>AUDIT_AGENT</option>
                                        <option value='POLICY_AGENT'>POLICY_AGENT</option>
                                    </select>
                                </div>
                                <div class='allocation-row'>
                                    <div class='allocation-task'>Risk Assessment</div>
                                    <select class='shahin-form-select' onchange=""updateAllocation(this, 'risk')"">
                                        <option value='RISK_AGENT' selected>RISK_AGENT</option>
                                        <option value='ANALYTICS_AGENT'>ANALYTICS_AGENT</option>
                                        <option value='AUDIT_AGENT'>AUDIT_AGENT</option>
                                    </select>
                                </div>
                                <div class='allocation-row'>
                                    <div class='allocation-task'>Report Generation</div>
                                    <select class='shahin-form-select' onchange=""updateAllocation(this, 'report')"">
                                        <option value='REPORT_AGENT' selected>REPORT_AGENT</option>
                                        <option value='ANALYTICS_AGENT'>ANALYTICS_AGENT</option>
                                        <option value='SHAHIN_AI'>SHAHIN_AI</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Human Backup Configuration -->
                <div class='col-md-6'>
                    <div class='shahin-card'>
                        <div class='shahin-card-header'>
                            <h4 class='shahin-card-title'>
                                <i class='bi bi-person-fill-check'></i> Human Backup Configuration
                            </h4>
                        </div>
                        <div class='shahin-card-body'>
                            <p class='text-muted mb-3'>Auto-delegate when designated human is absent:</p>
                            <div class='backup-config'>
                                <div class='mb-3'>
                                    <label class='shahin-form-label'>Primary Officer</label>
                                    <select class='shahin-form-select'>
                                        <option>Compliance Officer</option>
                                        <option>Risk Manager</option>
                                        <option>Audit Manager</option>
                                    </select>
                                </div>
                                <div class='mb-3'>
                                    <label class='shahin-form-label'>Backup Delegate</label>
                                    <select class='shahin-form-select'>
                                        <option>GRC Manager</option>
                                        <option>Security Officer</option>
                                        <option>Department Head</option>
                                    </select>
                                </div>
                                <div class='shahin-form-check'>
                                    <input type='checkbox' class='shahin-form-check-input' id='autoBackup' checked>
                                    <label class='shahin-form-check-label' for='autoBackup'>
                                        Enable automatic backup activation
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class='shahin-card-footer'>
                            <button class='shahin-btn shahin-btn-primary'>Save Backup Settings</button>
                        </div>
                    </div>
                </div>

                <!-- Change Communication Log -->
                <div class='col-12'>
                    <div class='shahin-card'>
                        <div class='shahin-card-header'>
                            <h4 class='shahin-card-title'>
                                <i class='bi bi-megaphone'></i> Change Communication Log
                            </h4>
                        </div>
                        <div class='shahin-card-body'>
                            <div class='communication-log'>
                                <div class='log-entry'>
                                    <div class='log-badge log-badge-info'>
                                        <i class='bi bi-info-circle'></i>
                                    </div>
                                    <div class='log-content'>
                                        <div class='log-header'>
                                            <strong>Workflow Updated: Compliance Review</strong>
                                            <span class='text-muted'>2 hours ago</span>
                                        </div>
                                        <p class='mb-0'>Added SLA checkpoint at review stage - stakeholders notified via email</p>
                                    </div>
                                </div>
                                <div class='log-entry'>
                                    <div class='log-badge log-badge-success'>
                                        <i class='bi bi-check-circle'></i>
                                    </div>
                                    <div class='log-content'>
                                        <div class='log-header'>
                                            <strong>Backup Activated: Risk Manager</strong>
                                            <span class='text-muted'>5 hours ago</span>
                                        </div>
                                        <p class='mb-0'>Primary officer absent - tasks auto-delegated to backup GRC Manager</p>
                                    </div>
                                </div>
                                <div class='log-entry'>
                                    <div class='log-badge log-badge-warning'>
                                        <i class='bi bi-exclamation-circle'></i>
                                    </div>
                                    <div class='log-content'>
                                        <div class='log-header'>
                                            <strong>Allocation Changed: Report Generation</strong>
                                            <span class='text-muted'>Yesterday</span>
                                        </div>
                                        <p class='mb-0'>Task routing updated - ANALYTICS_AGENT added as secondary option</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        ");
    }
}
