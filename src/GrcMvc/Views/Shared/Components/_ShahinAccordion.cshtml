@*
    SHAHIN AI GRC - Accordion Component
    Usage: <partial name="Components/_ShahinAccordion" model='new {
        Id = "myAccordion",
        Items = new[] {
            new { Title = "Item 1", Content = Html.Raw("<p>Content 1</p>"), Open = true },
            new { Title = "Item 2", Content = Html.Raw("<p>Content 2</p>"), Open = false },
            new { Title = "Item 3", Content = Html.Raw("<p>Content 3</p>"), Open = false }
        },
        AlwaysOpen = false
    }' />
*@
@{
    dynamic model = ViewData.Model ?? new { };
    var id = model?.Id ?? "shahinAccordion" + Guid.NewGuid().ToString("N").Substring(0, 8);
    var items = model?.Items as IEnumerable<dynamic> ?? new List<dynamic>();
    var alwaysOpen = model?.AlwaysOpen ?? false;
    var flush = model?.Flush ?? false;
}

<div class="accordion shahin-accordion @(flush ? "accordion-flush" : "")" id="@id">
    @{
        var itemList = items.ToList();
        for (int i = 0; i < itemList.Count; i++)
        {
            var item = itemList[i];
            var title = item.Title?.ToString() ?? $"Accordion Item {i + 1}";
            var content = item.Content ?? "";
            var open = (i == 0 && item.Open == null) || (item.Open != null && (bool)item.Open);
            var icon = item.Icon?.ToString() ?? "";
            var itemId = $"{id}-item-{i}";
            var headerId = $"{id}-header-{i}";
            var collapseId = $"{id}-collapse-{i}";

            <div class="accordion-item">
                <h2 class="accordion-header" id="@headerId">
                    <button class="accordion-button @(open ? "" : "collapsed")"
                            type="button"
                            data-bs-toggle="collapse"
                            data-bs-target="#@collapseId"
                            aria-expanded="@(open ? "true" : "false")"
                            aria-controls="@collapseId">
                        @if (!string.IsNullOrEmpty(icon))
                        {
                            <i class="bi bi-@icon me-2"></i>
                        }
                        @title
                    </button>
                </h2>
                <div id="@collapseId"
                     class="accordion-collapse collapse @(open ? "show" : "")"
                     aria-labelledby="@headerId"
                     @(alwaysOpen ? null : Html.Raw($"data-bs-parent=\"#{id}\""))>
                    <div class="accordion-body">
                        @content
                    </div>
                </div>
            </div>
        }
    }
</div>

<style>
    .shahin-accordion .accordion-item {
        border: 1px solid var(--shahin-gray-200);
        border-radius: var(--shahin-radius-base);
        margin-bottom: var(--shahin-space-2);
        overflow: hidden;
    }

    .shahin-accordion .accordion-button {
        background-color: var(--shahin-gray-50);
        color: var(--shahin-gray-900);
        font-weight: var(--shahin-font-weight-semibold);
        padding: var(--shahin-space-4) var(--shahin-space-5);
        border: none;
        transition: all var(--shahin-transition-base);
    }

    .shahin-accordion .accordion-button:not(.collapsed) {
        background-color: var(--shahin-primary-light);
        color: var(--shahin-primary-dark);
        box-shadow: none;
    }

    .shahin-accordion .accordion-button:hover {
        background-color: var(--shahin-primary-light);
        color: var(--shahin-primary-dark);
    }

    .shahin-accordion .accordion-button:focus {
        box-shadow: 0 0 0 3px var(--shahin-primary-light);
        border-color: var(--shahin-primary);
    }

    .shahin-accordion .accordion-button::after {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%230066cc'%3e%3cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e");
    }

    .shahin-accordion .accordion-body {
        padding: var(--shahin-space-5);
        background-color: var(--shahin-white);
        color: var(--shahin-gray-700);
    }

    .shahin-accordion.accordion-flush .accordion-item {
        border-radius: 0;
        border-left: none;
        border-right: none;
    }

    .shahin-accordion.accordion-flush .accordion-item:first-child {
        border-top: none;
    }

    .shahin-accordion.accordion-flush .accordion-item:last-child {
        border-bottom: none;
    }
</style>
