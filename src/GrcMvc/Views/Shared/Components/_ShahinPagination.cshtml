@*
    SHAHIN AI GRC - Pagination Component
    Usage: <partial name="Components/_ShahinPagination" model='new {
        CurrentPage = 3,
        TotalPages = 10,
        BaseUrl = "/Risk/Index",
        ShowFirstLast = true,
        MaxVisible = 5
    }' />
*@
@{
    dynamic model = ViewData.Model ?? new { };
    var currentPage = model?.CurrentPage ?? 1;
    var totalPages = model?.TotalPages ?? 1;
    var baseUrl = model?.BaseUrl ?? "#";
    var showFirstLast = model?.ShowFirstLast ?? true;
    var showPrevNext = model?.ShowPrevNext ?? true;
    var maxVisible = model?.MaxVisible ?? 5;
    var queryParam = model?.QueryParam ?? "page";

    int startPage = Math.Max(1, currentPage - (maxVisible / 2));
    int endPage = Math.Min(totalPages, startPage + maxVisible - 1);

    if (endPage - startPage < maxVisible - 1)
    {
        startPage = Math.Max(1, endPage - maxVisible + 1);
    }

    string GetPageUrl(int page)
    {
        var separator = baseUrl.Contains("?") ? "&" : "?";
        return $"{baseUrl}{separator}{queryParam}={page}";
    }
}

<nav aria-label="Page navigation">
    <ul class="pagination shahin-flex shahin-gap-2">
        @if (showFirstLast && currentPage > 1)
        {
            <li class="page-item">
                <a class="page-link" href="@GetPageUrl(1)" aria-label="First">
                    <i class="bi bi-chevron-double-left"></i>
                </a>
            </li>
        }

        @if (showPrevNext && currentPage > 1)
        {
            <li class="page-item">
                <a class="page-link" href="@GetPageUrl(currentPage - 1)" aria-label="Previous">
                    <i class="bi bi-chevron-left"></i>
                </a>
            </li>
        }

        @if (startPage > 1)
        {
            <li class="page-item disabled">
                <span class="page-link">...</span>
            </li>
        }

        @for (int i = startPage; i <= endPage; i++)
        {
            var page = i;
            <li class="page-item @(page == currentPage ? "active" : "")">
                <a class="page-link" href="@GetPageUrl(page)">@(page)</a>
            </li>
        }

        @if (endPage < totalPages)
        {
            <li class="page-item disabled">
                <span class="page-link">...</span>
            </li>
        }

        @if (showPrevNext && currentPage < totalPages)
        {
            <li class="page-item">
                <a class="page-link" href="@GetPageUrl(currentPage + 1)" aria-label="Next">
                    <i class="bi bi-chevron-right"></i>
                </a>
            </li>
        }

        @if (showFirstLast && currentPage < totalPages)
        {
            <li class="page-item">
                <a class="page-link" href="@GetPageUrl(totalPages)" aria-label="Last">
                    <i class="bi bi-chevron-double-right"></i>
                </a>
            </li>
        }
    </ul>
</nav>
